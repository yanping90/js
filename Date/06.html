<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <script src="../G.js"></script>
  <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="../template.js"></script>
  <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
</head>
<body>
<div class="date container">
  <div class="rili6">
    <div class="title clearfix">
      <div class="titleL"><a>上一月</a></div>
      <div class="titleM"></div>
      <div class="titleR"><a>下一月</a></div>
    </div>
    <ul class="weekday list-inline"></ul>
    <ul class="date-days list-inline" style=""></ul>
  </div>
</div>
<script type="text/html" id="list">
  {{each list as value}}
  <li>{{value}}</li>
  {{/each}}
</script>
<script>
    function Calendar (obj){
        this.selectWeek = obj.selectWeek;
        this.selectWeekTitle = obj.selectWeekTitle;
        this.selectDay = obj.selectDay;
    }
    Calendar.prototype.isValidDate = function(timeString){
        return !isNaN(new Date(timeString).getTime());
    }
    Calendar.prototype.formatDate = function(timeString){
        var d;
        if(Object.prototype.toString.call(timeString)=="[object Date]"){
            d = timeString;
        }
        else if(this.isValidDate(timeString)){
            d = new Date(timeString);
        }
        else{
            return timeString;
        }
        return d.getFullYear()+"-"+Math.abs(d.getMonth()+1)+"-01";
    }
    Calendar.prototype.getNextMonth = function(timeString){
        var d,month,nextMonth,year;
        if(this.isValidDate(timeString)){
            d = new Date(timeString);
            month = d.getMonth()+1;
            nextMonth = "0"+(month%12 + 1);
            year = d.getFullYear();
            if(month == 12){
                year++;
            }
            return year+"-"+nextMonth.substr(-2)+"-01";
        }else{
            return "";
        }
    }
    Calendar.prototype.getLastMonth = function(timeString){
        var d,lastMonth,year;
        if(this.isValidDate(timeString)){
            d = new Date(timeString);
            year = d.getFullYear();
            lastMonth =d.getMonth();
            if(lastMonth == 0){
                lastMonth = 12;
                year--;
            }
            return year+"-"+("0"+lastMonth).substr(-2)+"-01";
        }else{
            return "";
        }
    }
    Calendar.prototype.getMonthDays = function(timeString){
        return new Date(new Date(this.getNextMonth(timeString)).getTime()-86400000).getDate();
    }
    Calendar.prototype.fillFrontDays = function(timeString){
        var arrDays=[];
        var d,idx, i,days;
        var _self = this;
        if(_self.isValidDate(timeString)){
            d= new Date(timeString);
            idx = new Date(d.getFullYear() + "-" + ("0"+(d.getMonth()+1).toString()).substr(-2) + "-01").getDay();
            days = _self.getMonthDays(_self.getLastMonth(timeString));
            for(var i = days-idx+1;i<=days;i++){
                arrDays.push(i);
            }
            return arrDays;
        }else{
            return "空数组";
        }
    }
    Calendar.prototype.fillBackDays = function(timeString){
        var arrDays = [];
        var idx, d,i;
        var _self = this;
        if(_self.isValidDate(timeString)){
            d = new Date(timeString);
            idx= new Date(d.getFullYear()+ "-"+("0"+(d.getMonth()+1).toString()).substr(-2) + "-" + _self.getMonthDays(timeString)).getDay();
            for(i=1;i<7-idx;i++){
                arrDays.push(i);
            }
            return arrDays;
        }else{
            return "空数组";
        }
    }
    Calendar.prototype.fillDays = function(timeString){
        var _self = this;
        var i, j,arrFront,arrBack,days;
        if(_self.isValidDate(timeString)){
            arrFront = _self.fillFrontDays(timeString);
            arrBack = _self.fillBackDays(timeString);
            days = _self.getMonthDays(timeString);
            for(i=1;i<=days;i++){
                arrFront.push(i);
            }
            for(j=1;j<=arrBack.length;j++){
                arrFront.push(j);
            }
            return arrFront;
        }else{
            return "空数组";
        }
    }
    Calendar.prototype.showDays = function(timeString){
        var _self = this;
        if(this.isValidDate(timeString)){
            _self.selectWeek.html(
                    template(
                            "list",{
                                list:["日","一","二","三","四","五","六"]
                            })
            );
            _self.selectDay.html(
                    template("list",{
                        list:_self.fillDays(timeString)
                    })
            );
        }
    }
</script>
</body>
</html>